{"mappings":"AAAA,MAAMA,IAAM,+DACZC,oBAAOD,KAAKE,MAAKC,KAuDbC,iBACI,MAAMC,EAAMC,SAASC,cAAc,0BAA0BC,IACvDC,QA/CVL,eAAiCM,GAC7B,MAAMD,EAAQH,SAASK,cAAc,OAE/BC,QAAkBT,EAAOU,KAAK,OAC1BV,EAAOW,eAAeJ,EAAK,WAClC,CAEC,UAAW,SAAU,eAAgB,QAAS,UAAW,MAEzD,SAAU,MAAO,WAAY,OAAQ,QAAS,MAE9C,QAAS,OAAQ,aAAc,OAAQ,QAEvC,SAAU,MAAO,eAAgB,QAEjC,SAAU,MAGV,YAAa,QACb,WAAY,OAAQ,eAAgB,QAEpC,YAAa,SAAU,MAEvB,YAeEK,SAZuBZ,EAAOU,KAAK,CACrC,CAAEG,KAAM,SAAUC,QAASL,EAAU,GAAW,SACjD,CACC,UAAW,SAEX,YAAa,QACb,WAAY,MACZ,aAAc,MACd,WAAY,OAAQ,eAAgB,QACpC,YAGeA,EAAU,IAG7B,OAFAH,EAAMD,IAAMU,IAAIC,gBAAgBJ,EAAiB,MAE1CN,EAMaW,CAAkBf,GACtCC,SAASe,eAAe,QAAQC,YAAYb,GAIhDc","sources":["www/tangled/convert-images-to-mask.ts"],"sourcesContent":["const url = 'https://unpkg.com/wasm-imagemagick/dist/bundles/magickApi.js';\nimport(url).then(Magick => {\n    async function fetchImage(url: string) {\n        const image = await fetch(url, {\n            headers: {\n                'Sec-Fetch-Dest': 'image'\n            }\n        });\n        return new Uint8Array(await image.arrayBuffer())\n    }\n\n    async function getProcessedImage(url: string) {\n        const image = document.createElement('img');\n\n        const processed = await Magick.Call([\n            await Magick.buildInputFile(url, 'in.png')\n        ], [\n            //Let's initialise the image\n            'convert', 'in.png', '-bordercolor', 'white', '-border', '1x1',\n            // Set Alpha to most of the image\n            '-alpha', 'set', '-channel', 'RGBA', '-fuzz', '20%',\n            // Fill the image with white\n            '-fill', 'none', '-floodfill', '+0+0', 'white',\n            // Clean and set transparent\n            '-shave', '1x1', '-transparent', 'white',\n            // Increase the saturation\n            '-level', '30%',\n\n            // Convert to grey\n            '-modulate', '100,0',\n            '-channel', 'RGBA', '-transparent', 'white',\n\n            '-evaluate', 'Divide', '1.5',\n            // Export\n            'out.png',\n        ]);\n\n        const processed_grey = await Magick.Call([\n            { name: 'in.png', content: processed[0]['buffer'] }\n        ], [\n            'convert', 'in.png',\n            // Convert to grey\n            '-modulate', '100,0',\n            '-channel', 'RGB',\n            '-threshold', '80%',\n            '-channel', 'RGBA', '-transparent', 'white',\n            'out.png'\n        ]);\n\n        const firstImage = processed[0];\n        image.src = URL.createObjectURL(firstImage['blob']);\n\n        return image;\n    }\n\n\n    async function init() {\n        const img = document.querySelector('img[alt=\"machine.png\"]').src\n        const image = await getProcessedImage(img);\n        document.getElementById('demo').appendChild(image);\n\n    }\n\n    init();\n});\n"],"names":["url","__parcel__require__","then","Magick","async","img","document","querySelector","src","image","url2","createElement","processed","Call","buildInputFile","firstImage","name","content","URL","createObjectURL","getProcessedImage","getElementById","appendChild","init"],"version":3,"file":"20200405-convert-images-to-mask.2007a120.js.map"}